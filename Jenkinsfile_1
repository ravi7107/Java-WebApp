pipeline {
    agent {label 'deploy_server'}
    
    environment {
        // Update these with your AWS credentials and S3 bucket details
        AWS_ACCESS_KEY_ID = credentials('ravi_project_credentials') // You should add your AWS access key as a Jenkins credential
        AWS_SECRET_ACCESS_KEY = credentials('ravi_project_credentials') // You should add your AWS secret key as a Jenkins credential
        S3_BUCKET = 'mys301082023'
        S3_OBJECT_KEY = 'WebApp.war' // This is the specific file or folder path in the S3 bucket you want to copy
        LOCAL_DESTINATION = '/home/ubuntu/deploy_server/tomcat/webapps' // Local folder on the Jenkins agent to copy the S3 files
    }
    
    stages {
        stage('Install AWS CLI') {
            steps {
                sh 'apt-get update && apt-get install -y awscli' // For Linux-based agents
                // If you are using a different OS for Jenkins agents, adjust the package installation accordingly.
            }
        }
        
        stage('Copy files from S3') {
            steps {
                script {
                    // Use AWS CLI to copy files from S3 to the Jenkins agent
                    sh "aws s3 cp s3://${S3_BUCKET}/${S3_OBJECT_KEY} ${LOCAL_DESTINATION}"
                }
            }
        }
    }
}
